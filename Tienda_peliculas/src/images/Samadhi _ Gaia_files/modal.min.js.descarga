$(document).ready(function(){function t(e,a){$.getJSON("/wp-content/themes/gaia-marketing-layer/assets/json/login-language-pref.json",function(o){var n=e.error||(e.codes&&e.codes[0]?e.codes[0]:"default"),n=(n=!!n&&o[GAIA_GLOBALS.lang][n])||o[GAIA_GLOBALS.lang].default;a(n)}).fail(function(){console.log("Warning: Error loading language preference text config file.")})}function o(o){var n=$("input[login='login_user']"),e=$("input[login='login_pw']"),a=$("button.login-btn");""!==e.val()&&""!==n.val()?a.removeAttr("disabled"):a.attr("disabled","disabled")}$(".layer-modal .close-modal-btn").click(function(o){$.fn.closeModal()}),$(".login.btn, .login.link").click(function(o){$.fn.openModal($(".login-modal")),$(".login-modal").find(".username").focus()}),$(".layer-modal .login-modal").find("button.login-btn").click(function(o){o.preventDefault(),$(this).fadeOut(200,function(o){$(".login-modal").find(".loading").fadeIn(200),$.ajax({method:"POST",url:GAIA_GLOBALS.dbi_brooklyn_api+"/v1/login",crossDomain:!0,data:{cookie:{include:!0,domain:GAIA_GLOBALS.dbi_aws_domain},username:$(".login-modal").find(".username").val(),password:$(".login-modal").find(".password").val()},dataType:"json",success:function(o,n,e){var a,l;1==o.success?(l=new Date,a=new Date(o.cookie.options.expires),l=Number(Math.ceil((a.getTime()-l.getTime())/864e5)),Cookies.set(o.cookie.name,o.cookie.value,{expires:l,secure:o.cookie.options.secure,httpOnly:o.cookie.options.httpOnly}),$.fn.getLoggedInLanguagePref(o.jwt,function(o){"unknown"!==o&&$.fn.setLanguagePreference(o,!0)}),document.location.pathname==="/"+GAIA_GLOBALS.lang||"job"===GAIA_GLOBALS.content_type||"article"===GAIA_GLOBALS.content_type||"hub"===GAIA_GLOBALS.content_type?window.location="/"+window.location.search:location.reload()):t(o,function(o){$(".login-modal .error-message").text(o),$(".login-modal").find(".loading").hide().end().find("button").show()})},error:function(o,n,e){console.log("Auth API Data Error: ",n," errorThrown: ",e)}})})}),$("input[login='login_pw'] , input[login='login_user']").on("load",o()).on("keyup change blur focus input",o);var e,a,n,l=$("#forgot-pw-send");if($(l)&&$(l)[0]&&!$(l)[0].checkValidity())return $(l).find('input[type="submit"]').click(),!1;$(".layer-modal .forgot-password-modal").find("button").click(function(o){o.preventDefault();var a=$(".forgot-password-modal").find(".email").val();$(this).fadeOut(200,function(){$(".forgot-password-modal").find(".loading").fadeIn(200),$.ajax({method:"POST",url:GAIA_GLOBALS.dbi_brooklyn_api+"/v1/password/send-email",data:{email:a,primaryLanguage:GAIA_GLOBALS.lang},dataType:"json",success:function(o,n,e){!0===o.success?$(".layer-modal").find(".modal-inner").hide().end().find(".forgot-password-confirm-modal").find(".forgot-password__email").text(a).end().show():t(o,function(o){$(".forgot-password-modal .error-message").text(o),$(".forgot-password-modal").find(".loading").hide().end().find("button").show()})},error:function(o,n,e){console.log("Warning!: PW Reset Error: ",n," errorThrown: ",e)}})})}),$(".layer-modal .login__forgot-password-link").click(function(o){$.fn.openModal($(".forgot-password-modal")),$(".forgot-password-modal").find(".email").focus()}),$(".layer-modal .forgot-password-confirm-modal").find("button").click(function(o){$(".layer-modal").find(".forgot-password-modal").find(".password").val(""),$.fn.closeModal()}),$(".layer-modal .language-selection-modal").find("button").click(function(o){$.fn.openModal($(this),!1)}),$(".language-selection-modal.modal-inner a").click(function(o){o.preventDefault(),$(".layer-modal .language-selection-modal").find("button").attr("disabled",!1),$(".layer-modal .language-selection-modal").find("button").removeClass("btn--disabled"),o=$(this),$(".language-selection-modal .selector__modal--option, .language-selection-modal .circle ").removeClass("highlight"),$(o).find(".circle").addClass("highlight").end().closest(".selector__modal--option").addClass("highlight")}),$(".language-selection-modal.modal-inner button.btn").click(function(o){o.preventDefault();o=$(".language-selection-modal.modal-inner .selector__modal--option.highlight a");$.fn.setLanguagePreference($(o).attr("data-lang"),!0),$.fn.preserveQueryString(window.location.pathname)!==$.fn.preserveQueryString($(o).attr("href"))?($.fn.closeModal(),window.open($.fn.preserveQueryString($(o).attr("href")),"_self")):$.fn.closeModal()}),GAIA_GLOBALS.language_detection&&(n=a=e=null,localStorage.getItem("gaia")&&(n=JSON.parse(localStorage.getItem("gaia")),$.each(n,function(o,n){n.user&&n.user.data&&n.user.data.language?(-1==o||-1<o&&null===e)&&(e=n.user.data.language[0],a=o):a=o})),n&&n[a]&&n[a].user&&n[a].user.data&&void 0!==n[a].user.data.languageAlertBarAccepted&&""!==n[a].user.data.languageAlertBarAccepted&&-1==a&&null!==e?(l=document.location.pathname+document.location.search,n="/"+window.location.search,l!==(n="en"!==e?"/"+GAIA_GLOBALS.locale+"/"+e+window.location.search:n)&&(window.location=n)):(null===e&&(e=window.navigator.language.substring(0,2)),GAIA_GLOBALS.lang!==e&&$.fn.openModal($(".language-selection-modal"),!1)))});